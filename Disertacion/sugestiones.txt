

ademas de la logica anterior, se asume que se tiene un tren, con varios vagones, que va a viajar de una estacion E1 hasta una estacion En (donde n es la ultima estacion donde llegará el tren), dicho tren tendra un itinerario el cual contendra, el nombre del tren, la estacion de origen, la estacion de destino, la fecha y hora de partida y de llegada. Ademas se tendrá una lista de precios (para el mismo tipo de asientos) para disponibilizar para venta. A cada uno de los precios de la lista la llameros clase comercial o control class. los boletos seran disponibilizados para ventas antes de la salida del tren, y el tiempo entre la disponibilizacion y dicha salida sera llamado horizonte de reserva. Dicho horizonte estara divido en multiples periodos que pueden ser de diferente temporalidad, por exemplo, se pueden tener periodos en dias, semanas, meses, etc, y combinaciones de ellos. Cada uno de esos periodos sera llamado check point. 

cada relacion posible entre una estacion y otra sera denominda origen-destino o trecho. se dira que un origen-destino es adjacentes, si y solo si, no existan estaciones intermedias entre los mismos, caso contrario seran no adjacentes. Por ejemplo, en la figura xxx, los trechos adjacentes serian: E1-E2, E2-E3, E3-E4 y los trechos no adjacentes serian: E1-E3, E1-E4 y E2-E4.
ademas note que los trechos no adjcentes pueden contener otros trechos, tanto adjacentes como no adajacentes, por ejemplo, el trecho E1-E4 contine los trechos adjacentes E1-E2, E2-E3, y contiene los trechos no adjacentes E1-E3 y E2-E4

K_v
es el conjunto de clases de control para cada vagon. por ejemplo, suponga que se tienen dos cavinas "z" y "p", y cada cavina contiene tres clases de control c1, c2, c3, entonces la representacion seria K_z : {c1, c2, c3} y K_p:{c1,c2,c3}, ademas tenga en cuenta que los elementos para cada K_v son ordenados, donde siempre se cumple que c1>c2>c3.

A_i
almacena la cantidad de asientos vacios disponibles para ventas en cada estacion de origen en todo el horizonte de reserva. cabe aclarar que no es una variable de desicion pues esta variable solo almacena un calculo en funcion de la capacidad fisica del tren y las variables de desicion de assigments y atribucoes.

suponga que tiene un trecho nao adjancente E1-E3, y que ese trecho contiene otros trechos E1-E2 y E2-E3, para esta situacion, la clases mas barata activada en el trecho E1-E3 debera ser la clase mas barata activada en los trechos E1-E2 y E2-E3

una vez calculados los valores para BNA de los trechos no adjacentes, la restriccion xxx hara que las clases de control de todos  los trechos contenidos en cada trecho no adjacente sea cero o minimo 1. asi, donde la clase de control del trecho no adjacente tome un valor de BNA = 0 entonces dicha clase sera cero para los trechos contenidos, por otro lado si la clase de control del trecho nao adjacente toma el valor de BNA = 1, entonces dicha clase tomara minimo el valor de 1 para todos los trechos contenidos. 




hasta ahora se hablo de una demanda independiente para el modelo, pero ahora se trabajará con una demanda comportamenetal. La demanda comportamental esta más cerca de la realidad que la demanda independiente, vease el siguiente ejemplo:

supongamos para este caso que se tiene un trecho E1-E2 y tres clases (c1, c2, c3), onde o preco de c1>c2>c3. Cada clase tendrá una demanda de 10, 20 y 30 respectivamente. 

para interpretar la demanda independinete podemos decir (segun la figura a) que: se tienen 10 posibles personas dispuestas a comprar boletos a un precio c1, 20 personas a comprar a un precio c2 y 30 perosnas a comprar a un precio de c3. Sin embargo, si las 10 personas dispuestas a pagar c1 hallan un mejor mejor valor al momento de hacer la compra (por ejemplo c3), estas personas preferirian no comprar aun cuando encuentren un precio mas barato. situacion que en la realidad no tendria sentido.

por otro lado, tenemos la demanda comportamental, que es representada con una lista de preferencia tal como se ve en la figura, esta lista significa que, por ejemplo, 10 persona estan dispuesta a comprar hasta un precio con valor c1, 20 personas estan dispuestas a comprar hasta un valor de c2 y 30 perosnas estan dispuestas a comprar hasta un valor de c3.
el funcionanmiento seria el sigueinte, imagine que las 10 perosnas dispuestas a comprar con valor de c1 van a intentar comprar primero a un valor mas barato, en este caso c3, si c3 no estubiera disponible, buscarian asientos con valor c2, si c2 no estuviera disponible, subirian en la lista y bucarian boletos con valor de c1, si estos no estubieran disponible entonces no compraran. Note que ese compartamiento es el que comunmente se usa en la realidad.

ahora veamos como el modelo leeria ese nuevo comportamento. Para eso calculemos la nueva demanda potencial:
para c1 veamos la lista y notemos quien esta dispuesto a pagar por ese valor:
segun la figura solo 10 posibles pasajeros estan dspuestos a pgar ese valor

ahora veamos quien esta dispuesto a pagar a un valor por un boleto de la clase c2:
en este caso 30 posibles personas estarian dispuestas a pagar a este valor. Note que de esta nueva demanda, 10 personas correspondinetes a la demanda de c1, tambien estarian dispuestas a comprar al valor de la clase c2.

por tultimo para la clase mas barata c3, se tiene lo siguiente:
Note que en este caso 60 personas estarian dispuestas a pagar un boleto de clase c3, osea toda la demanda de ruta 1-2 compraria al valor mas barato si este estuvuera disponible

es asi que la demanda potencial comportamental para el modelo seria:

sin embargo hay que recordar que la demanda potenial inicial era de 60 personas, mas hasta este punto, la demanda podria ser mayor, puesto que, la demanda de cada clase comercial ahora es el acumulo de las demandas de las clases mas caras. Esta situacion es necesario controlarla para no crear una demanda inexistente, para eso se tendran en cuenta las sigueintes restricciones realcionando en este caso las variables de desicion de aseguraminetos


note que las restricciones de xx hasta xxx son restricciones conocidas que limitan los valores que puede tomar los aseguramientos, mientras que las restricciones y y yy son las que nos ayudaran a controlar que no sobrepasemos la demanda potencial total inicial, que para el ejemplo de la figura 2.6 era de 60.


el problema de trasnporte ferroviario tiene una restriccion importante que dice que una clase puede ser asegurada siempre y cuando esa misma clase ya fue asegurada en periodos anteriores. Para eso se definen las restricciones 2.11 y 2.12 , en donde la primera busca asignar un valor de 1 a la variable BX cuando X toma un valor distinto de cero , y asigna 0 en caso contrario; esta restriccion tiene la misma estructura y raciocinio que la restriccion 2.8.
ahora, la restriccion 2.12 garantiza que, cierta varible binaria BX tomará el valor de 1 si y solo si en el periodo anterior tomo el valor de 1 tambien, en caso contrario queda libre para tomar qualquier valor, 0 o 1. Esto significa que solo se puede asegurar cierta clase si esa misma clase se aseguró en el periodo anterior, veamos u ejemplo:

suponga, que t = 0, es la fecha de partida del tren , osea entre mayor sea el valor de t mas lejos estara de la fecha de partida, por lo que t = 1 sera el periodo exactamente anterior a t=0.

para cada trecho, vagon, y clases dados en la figura, suponga que:
la figura "a" es una solucion factible que representa la cantidad de asientos asegurados para el periodo t=1; la figura "b", es la variable binaria BX, que muestra 1 siempre y cuando la cantidad de asientos asegurados sea distista de cero en t = 1, y muestra cero en caso contrario (controlado por la restriccion xx). las figuras c y d representan lo mismo que las figuras a y b solo que para el periodo t = 0.

observe que las posiciones en la figura d tomarán el valor de cero siempre que en la figura b esa posicion sea cero tambien, esto significa que, si la clase del periodo anterior es cero entonces la del periodo actual tambien lo será. Note tambien, que cuando en la figura b el valor es 1, en la figura d el valor podrá ser 0 o 1, por ejemplo, para el techo 1-3 del vagon v1 y clase 2, note que en la figura b es 1 y en la figura d es cero, lo que significa que la clase 2 fue asegurada en el periodo anterior pero en el periodo actual no lo fue.



DEMANDA INDEPENDIENTE
para este modelo asumiremos una demanda independiente, lo que significa que cada cliente puede comprar un producto especifico independientemente de la oferta disponible a la hora de la compra. en otras palabras se podria decir que si un clinete esta dispuesto a pagar un valor, por ejemplo de 10 reales, por un asiento, este solo comprará el boleto por exactamente ese valor, aun si estubiera un precio mas bajo disponible. ahora si el no encuntre ese valor exacto preferira no comprar


es un conjunto que contiene otros conjuntos, donde cada subconjunto es una posible ruta para ir desde el origen o hasta el destino d, donde o,d es no adyacente. Por ejemplo para la ruta E1-E4 de la figura xx. CR[E1,E4] = {{()}}



la restriccion 2.13 y 2.14 cumplen la misma funcion de encontrar la ultima clase que fue disponibilizada para venta para cierto trecho, periodo y vagon. solo que la restricicon 2.14 es aplicada siempre que se analisa la clase mas barata, y en otro caso, se usa la restricion 2.13. Entonces estas dos ecuaciones asignan el valor de 1 a la variable BL_{ijvkt} siempre que la clase actual k sea la clase mas barata disponibilizada para la venta, en el trecho i,j vagon v y periodo t, en otro caso, asigna el valor de cero. Esta restriccion es necesaria para aplicar la restriccion 2.15 y 2.16.

los periodos dentro del horizonte de reserva estan ordenados de forma descendente donde el menor valor es cero y representa la fecha de salida del tren.

usemos el mismo ejemplo de la figura 25 usando solo el trecho e1-e3 y adicionamos la varible binaria BL. En la figura 2.7a  vemos como para la clase mas barata C6, BL = BY = 0 , ahora, para el resto de las clases se reliza un calculo en funcion de los valores de BY, por ejemplo, para la clase c1 sera el calculo es BY de c1 menos BY de la siguiente clase, osea BY de c2, esto seria igual a 1 - 1, note ademas que para la clase c4, haciendo el mismo calculo, este resulta en 1 tal como se ve en la figura 2.7b, y note que esa clase es la ultima clase que tiene asignado un valor diferente de cero en BY.

dentro del problema se debe garantizar que para todos los trechos con igual estacion de origen, los trechos mas cortos disponibilizados para la venta, sean mas economicos que los trechos mas largos, esto con el fin de que los posibles pasajeros no compren un boleto en un trecho mayor y desiendan en estaciones anteriores. por ejemplo, si una persona quisiera ir de la estacion E1 a la estacion E2, pero nota que el precio de ir de la estacion E1 a la estacion E3 es mas barato, entonces, esa persona comprara ese boleto de E1 a E3 y desendera en la estacion E2. Esta situacion es controlada por la restriccion 2.15. 

veamos un ejemplo mas claro, en la figura 2.8 se tienen tres estaciones, se asume un solo periodo y un solo vagon, ademasse tienen tres clases para cada trecho. note que BY y BL son las variables binarias explicadas anteriormente y P es precio de cada clase de control. para este caso la rstriccion 15 se puede aplicar para los trechos e1-e2 y e1-e3, entonces veamos como la suma producto del precio y la variable bl activan el precio de la clase mas barata (c3 con valor de 7) en e1-e2 y la suma producto de e1-e3 activan el precio de la clase c2 (con valor de 8), al finan se tendria que 7 tiene que ser menor o igual que 8, condicion que se cumple. note la importancia del valor de la variable BL que es la encargada de "habilitar solo los precios" de las clases mas baratas disponibilizadas para la venta.

ademas de lo anterior tambien se debe garantizar que todas las posibles combinaciones de los precios mas baratos de los trechos contenidos dentro de los trechos no adyacentes, sean mayores o iguales que el precio de ese trecho no adyacente. esta situacion es controlada por la restriccion 2.16. 

para dar un ejemplo analicemos de nuevo la figura 2.8 e identifiquenos los trechos no adyacentes y los trechos que estos contengan, entonces notemos que el trecho e1-e3 seria el unico trecho no adyacente y contiene a los trechos e1-e2 y e2-e3, por lo que debemos garantizar que la suma de las clases mas baratas disponibilizadas en e1-e2 y e2-e3 sean mayores o iguales que la clase mas barata disponibilizada en e1-e3. en terminos numericos tendriamos que $5 + $3 >= $8. por lo cual este ejemplo satisface nuestra restriccion.

por jemplo, si x12c2 toma el valor de 30 (restriccion 2.23) a restriccion 2.25 garantiza que x12c1 sea 0 pueste la demanda de 10 perosnas correspondiente prefirio comprar a precio c2. misma situacion pasaria si x12c3 toma el valor de 60 (retsrccion 2.24) , entonces la restricion 2.26 garantizaria que la demanda de x12c1 y x12c2 fuese cero pues estas decidieron comprar al valor de la clase c3. de esta manera este conjunto de restricciones funcionaria para cada combinacion posible de las variables descritas.

ahora, para escribir el modelo completo usando la demanda comportamental basada en rangos, basta con modificar solo las restricciones que controlan la demanda en el modelo independiente y adicionar las restricciones descritas del modelo comportamental:


las restricciones xx y oo son la generalizacion de las restricciones de 2.22 a 2.26 y solo adicionando estas dos ultimas restricciones y eliminando la restriccion xx del modelo independiente tendriamos un modelo con demanda comportamental, sin embargo, esa afirmacion no es del todo cierta, pues si bien estamos restringiendo la demanda del modelo para que se puedan usar las listas de preferencia, el modelo se seguira comportando como un modelo independiente. Esto ocurre porque, la demanda independinete es un caso particular de todas las posibles combinaciones que se podrian generar al usar las listas de preferencia, ademas, es el caso que mayor lucro generaria, recordemos que las listas de preferencia dan la flexibilidad de que un cliente que este dispuesto a pagar caro pueda comprar mas barato si existe la posibilidad, cosa que la demanda independiente no permite. Note que con esto, sabemos de antemano, que la solucion buscada sera menor que la solucion ofrecida por el modelo independiente.

Ademas de lo anterior, sabemos tambien, que el modelo tiene um comportamiento optimista pues asume que aquellas personas que estan dispuestas a pagar mas caro siempre llegaran primero que aquellas personas que estan dispuestas a pagar mas barato (esto debido a la formulacion de la funcion objetivo). 

Es asi que no basta con solo la restricciones xx y oo para afirmar que tenemos un modelo con demanda comportamental, por lo que de alguna manera hay que decirle al modelo que use otras posibilidades "mas realistas" durante la resolucion del problema. Es aqui donde adicionamos las sigueintes restricciones que ayudaran a nermar un poco esta situacion:


para estas nuevas restricciones, ademas de la demanda comportamental tambien usaremos la demanda independiente. Entoces para la restriccion 2.29 lo que hacemos es calcular las proporciones de la demanda independinete de las clases de cada trecho, vagon y periodo y luego dichas proporciones las multiplicamos por la demanda comportamental, esto hara que las demandas comportamentales portenciales para cdad clase disminuyan a la proporcion de la demanda independiente. Asi garantizamos que la solucion no sea la misma que la ofrecida por el modelo independiente. Note que al calcular dicha proporcion se dismuye la demanda comportamental y existe una "perdida de demanda", ese complemento es sumado a la clase mas barata del trecho, vagon y periodo analizado tal como lo muestra la restriccion 2.30. de esta forma estimulamos al modelo para que use las clases mas baratas. veamos un ejemplo:

asuma que tiene un trecho con tres clases para un vagon y un periodo, diclas clases tienes parametros de demanda independiente d tal como se muestra en la tabla 2.3.

note que la columna % muestra las proporciones calculas en funcion de la demanda independinte d, la columna d' muestra la demanda comportamental potencial y la columna %*d' muestra el producto entre % y d', ademas observe que que esta ultima columna para la clase mas barata c3, es 10 (que es el resultado del producto ya mencionado) mas 29.12 (que es el complemento de la demanda, osea 104 - (12.46+52.42+10))


el grafico xx nos ayuda a tener una mejor vision del problema, vea como en la parte a tenemos la demanda independiente vs la demanda comportamental, note que siempre d' >= d. y que independientemente de los valores que tome d' el modelo seleccionara los valores de d pues son los que generaran el mayor lucro. Ahora, despues de la aplicacion de nuestro ajuste, note como le "quitamos demanda" tanto a la clase de c1 o c2 para asignarsela a c3, ya d' no siemore es mayor igual que d y el modelo se me forzado a tener el cuenta el limite mas bajo, por lo que ahora se tendra en cuenta la demanda comportamental ajustada. En otras palabras, estamos diciendo que parte de las personas que estaban dispuestas a pagar mas caro, llegaron primero y encontraron opciones mas baratas y aprobecharon esa situacion para hacer la compra.

para verificar las caracteristicas de los modelos propuestos, se usaron 10 instancias reales proporcionadas por la empresa Canadiense Expetrio. las caracteristicas de cada una de ellas son mostradas en la tabla xx.

la columna # trechos representa la cantidad de trechos que tiene el viaje del tren de cada instancia; la columna # periodos representa la cantidad de periodos de la planeacion de ese viaje en su horizonte de reserva. por ultimo, la columna # classes representa hasta cuantas clases puede tener disponible cada viaje de cada tren.

note que para cada trecho puede estar disponible todas las clases mostradas en la columna o menos. 

por otro lado afiramos que las instancis comprendidas entre la instacnia 1 y la estancia 4 son instacnias grandes, las instancias entre la instancia 5 y la instancia 7 son medianas y el resto son pequeñas

para resolver las instancias usando lo modelos matematicos propuesto se uso, un computador de la marca Dell modelo, Precision 3660 con Windows 11 Pro de de 64 bits, Processador 13th Gen Intel(R) Core(TM) i7-13700 2.10 GHz basado en x64 y con memoria ram de 16GB. ademas se uso python como lenguaje de programacion en su version 3.10.14 y el solver Gurobi en su version 11.0.3.


si bien se propon dos modelos matematicos, el modelo independiente y el modelo comportamental, a la hora de resolver las instancias de desidió probar los modelos inicialmente sin las restricciones de fulfiiltime ni las restricciones de skip. Luego se probo cada modelo con cada grupo de restricciones por separado y por ultimo se probo cada modelo con los dos conjunto de restricciones. Esto se realizo de esa manera para observar como evolucionaba o se comportaba la solucion al contemplar cada tipo de restricciones.

en primer lugar se realizo un analisis por instancia, en donde cada una de ella es resuelta por cada modelo de la tabla xx. la idea es evidenciar de forma clara y comparativa las semejansas y diferencias en las soluciones obtenidas.

a continuacion se presentan los resultados para cada instancia depues de ser resuelta por cada uno de los modelos.

otro enfoque que se propuso, alternativo a las restricciones 29 y 30, fue controlar la demanda, esta vez, creando una jerarquia descendente para las clases de la variable de desicion X de cierto vagon, cierto trecho y cierto periodo. Lo que en teoria, homogeniza los valores que podria tomar X, asignando valores muy parecidos a todas las clases en las condiciones mencionadas. veamos un ejemplo:


otro enfoque que se propuso, alternativo a las restricciones 29 y 30, fue controlar la demanda, esta vez, creando una jerarquia descendente para las clases de cierto vagon, cierto trecho y cierto periodo. Lo que en teroria, esto homogeniza la demanda inicial de las clases asignando valores muy parecidos a todas ellas en las condiciones mencionadas. veamos un ejemplo:

retomemos de nuevo el ejemplo de la tabla 2.3. si nosotros aplicamos esta nueva logica, al final el resultado esperado seria que c1<c2<c3. ahora, como en este punto (antes de adicionar las restricciones que complementan la demanda comportamental), el modelo continua comportandose como independiente, situacion que ya se explico, entonces el modelo tomaria como base la demanda independiente para crear la jerarquia descendiente. 
hay que tener en cuenta algo muy importante, se acabo de decir que el modelo toma en cuenta la demanda independiente para hacer el ajuste en la jerarquia, sin embargo, al momento de escribir la restriccion se uso la variable X, esto no es una contradiccion y fue hecho agrede. De hecho, esto se hizo para explicar de forma practica como funciona el modelo internamente. dicho eso, una solucion para nuestro ejemplo seria:

en este caso la columna X representa a solucion mas golosa que podria tomar X, note como los valores son muy parecidos para cada clase y se respeta el orden decreciente. 

Este ultimo enfoque no necesita intervencion directa en la demanda comporamnetal ya calculada (asi como el primer enfoque), solo adicionamos una condicion para la variable X que logra activar la caracteristica de la lista preferncia del modelo.

la restricccion 2.8 es usada para saber cuando, la variable de desicion Y, toma valores diferentes de cero y cuando no. Entonces ella toma el valor de 1 en el primer caso y 0 en caso contrario.


otra condicion especial deste problema es cuando se trata de disponibilizar los precios de los boletos en el tiempo, y se refiere a que estos deben tener un sentido logico que no permita intermitencias en funcion del tiempo, en otras palabras, los precios de los boletos siempre aumentaran conforme se este mas cerca de la fecha de partida del tren, la restriccion 5 se encarga de cumplir dicha condicion.

la restriccion 2.2 es la encargada de almacenar la cantidad de asientos vacios disponibles en cada estacion de origen de cada tipo de asiento en todo el horizonte de reserva. y es la generalizacion del ejemplo simplificado para calcular ai

la restriccion 2.3 garantiza que los assientos reservados en todo el horizonte de reserva, para cada trecho, no excedan la capacidade dispuesta para cada tipo de asiento en cada estacion de origen. 
